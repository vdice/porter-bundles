name: brigade-github-app
description: "A Porter bundle to deploy a Brigade GitHub App Gateway to Kubernetes via Helm"
version: 0.1.0
tag: vdice/brigade-github-app

mixins:
  - helm3:
      clientVersion: v3.3.1
      repositories:
        brigadecore:
          url: "https://brigadecore.github.io/charts"

credentials:
  - name: kubeconfig
    path: /root/.kube/config

parameters:
  - name: name
    type: string
    default: brigade-gh-app
  - name: namespace
    type: string
    default: default
  - name: chart-values
    type: string
    path: /cnab/app/chart-values.yaml
    default: ''

install:
  - helm3:
      description: "Install Brigade GitHub App Gateway: {{ bundle.parameters.name }}"
      name: "{{ bundle.parameters.name }}"
      namespace: "{{ bundle.parameters.namespace }}"
      chart: brigadecore/brigade-github-app
      wait: true
      values:
        - /cnab/app/chart-values.yaml

status:
  - helm3:
      description: "Check status of Brigade GitHub App Gateway: {{ bundle.parameters.name }}"
      arguments:
        - status
        - "{{ bundle.parameters.name }}"
      flags:
        o: yaml

upgrade:
  - helm3:
      description: "Upgrade Brigade GitHub App Gateway: {{ bundle.parameters.name }}"
      name: "{{ bundle.parameters.name }}"
      namespace: "{{ bundle.parameters.namespace }}"
      chart: brigadecore/brigade-github-app
      wait: true
      values:
        - /cnab/app/chart-values.yaml

uninstall:
  - helm3:
      description: "Uninstall Brigade GitHub App Gateway: {{ bundle.parameters.name }}"
      purge: true
      releases:
        - "{{ bundle.parameters.name }}"


