name: brigade
description: "A Porter bundle to deploy a Brigade server to Kubernetes via Helm"
version: 0.1.0
tag: vdice/brigade

mixins:
  - helm3:
      clientVersion: v3.3.3
      repositories:
        brigadecore:
          url: "https://brigadecore.github.io/charts"

credentials:
  - name: kubeconfig
    path: /root/.kube/config

parameters:
  - name: namespace
    type: string
    default: default
  - name: chart-values
    type: string
    path: /cnab/app/chart-values.yaml
    default: ''

install:
  - helm3:
      description: "Install Brigade"
      name: "{{ installation.name }}"
      namespace: "{{ bundle.parameters.namespace }}"
      chart: brigadecore/brigade
      wait: true
      values:
        - /cnab/app/chart-values.yaml

status:
  - helm3:
      description: "Brigade Status"
      arguments:
        - status
        - "{{ installation.name }}"
      flags:
        o: yaml

upgrade:
  - helm3:
      description: "Upgrade Brigade"
      name: "{{ installation.name }}"
      namespace: "{{ bundle.parameters.namespace }}"
      chart: brigadecore/brigade
      wait: true
      values:
        - /cnab/app/chart-values.yaml

uninstall:
  - helm3:
      description: "Uninstall Brigade"
      purge: true
      releases:
        - "{{ installation.name }}"


